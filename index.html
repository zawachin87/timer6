<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>4åˆ†å‰²ã‚¿ã‚¤ãƒãƒ¼ï¼ˆè¤‡æ•°èƒŒæ™¯ç”»åƒï¼‰</title>
<style>
body {
  margin: 0;
  background-color: #444; /* éš™é–“ã®è‰² */
  font-family: sans-serif;
}
.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 10px;
  height: 100vh;
  padding: 10px;
  box-sizing: border-box;
}

.timer, .empty {
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2em;
  cursor: pointer;
  transition: background-color 0.3s;
  color: rgb(0, 0, 0);
  position: relative;
  overflow: hidden;
}

/* ã‚¿ã‚¤ãƒãƒ¼å€‹åˆ¥è‰²ï¼‹è¤‡æ•°èƒŒæ™¯ç”»åƒ */
.timer2 {
  background-color: #1E90FF;
  background-image: url('IMG_4347.png'), url('IMG_4352.png'), url('IMG_4350.png');
  background-repeat: no-repeat, no-repeat, no-repeat;
  background-size: 30% auto, 30% auto, 30% auto;
  background-position: left center, center center, right center;
}

.timer3 {
  background-color: #1E90FF;
  background-image: url('IMG_4348.png'), url('IMG_4349.png');
  background-repeat: no-repeat, no-repeat;
  background-size: 45% auto, 45% auto;
  background-position: left center, right center;
}

.timer1 {
  background-color: #1E90FF;
  background-image: url('IMG_4351.png');
  background-repeat: no-repeat;
  background-size: contain;
  background-position: center;
}

.empty1 {
  background-color: #1E90FF;
  background-image: url('image7.jpg');
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  font-size: 1.5em;
}

/* å®Ÿè¡Œä¸­ã®è‰² */
.timer1.running { background-color: #DA70D6; }
.timer2.running { background-color: #DA70D6; }
.timer3.running { background-color: #DA70D6; }
.empty1.running { background-color: #DA70D6; }

/* ç§’æ•°æ–‡å­— */
.time { color: rgb(255, 255, 255); font-size: 2em; font-weight: bold; }
</style>
</head>
<body>

<div class="grid">
  <div class="timer timer1" data-time="150"><span class="time">150</span></div>
  <div class="timer timer2" data-time="100"><span class="time">100</span></div>
  <div class="timer timer3" data-time="90"><span class="time">90</span></div>
  <div class="empty empty1">ç‰¹è³ªåˆ‡ã‚Šæ›¿ãˆ</div>
</div>

<script>
const timers = document.querySelectorAll('.timer');
const empty = document.querySelector('.empty');
let runningTimer = null;

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function beep() {
  // iOSå¯¾ç­–ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾Œã«æœ‰åŠ¹åŒ–ï¼‰
  if (audioCtx.state === 'suspended') {
    audioCtx.resume();
  }

  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  // ğŸ”Š éŸ³ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼
  osc.type = 'square';      // sine / square / triangle / sawtooth
  osc.frequency.value = 880; // éŸ³ã®é«˜ã•ï¼ˆHzï¼‰

  // ğŸ”‰ éŸ³é‡ã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—ï¼ˆãƒ”ãƒƒæ„Ÿã®è‚ï¼‰
  gain.gain.setValueAtTime(0, audioCtx.currentTime);
  gain.gain.linearRampToValueAtTime(0.15, audioCtx.currentTime + 0.01);
  gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.08);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.1);
}

function startTimer(timer) {
  if (timer.classList.contains('running')) return;

  timer.classList.add('running');
  runningTimer = timer;

  timer.interval = setInterval(() => {
    let timeEl = timer.querySelector('.time');
    let t = Number(timeEl.textContent) - 1;
    timeEl.textContent = t;

    if (t <= 10 && t > 0) beep();

    if (t <= 0) {
      resetTimer(timer);
    }
  }, 1000);
}

function resetTimer(timer) {
  clearInterval(timer.interval);
  timer.classList.remove('running');
  timer.querySelector('.time').textContent = timer.dataset.time;
  if (runningTimer === timer) runningTimer = null;
}

/* é€šå¸¸ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¿ãƒƒãƒ— */
timers.forEach(timer => {
  timer.addEventListener('click', () => {
    if (timer.classList.contains('running')) {
      resetTimer(timer);
    } else {
      startTimer(timer);
    }
  });
});

/* ç‰¹è³ªåˆ‡ã‚Šæ›¿ãˆ */
empty.addEventListener('click', () => {
  if (!runningTimer) return;

  const current = runningTimer;
  const currentOriginal = Number(current.dataset.time);
  const currentRemaining = Number(current.querySelector('.time').textContent);

  const progressRate =
    (currentOriginal - currentRemaining) / currentOriginal;

  timers.forEach(t => {
    if (t !== current && !t.classList.contains('running')) {
      const original = Number(t.dataset.time);
      const newTime = Math.max(
        0,
        Math.floor(original * (1 - progressRate))
      );
      t.querySelector('.time').textContent = newTime;
      startTimer(t);
    }
  });
});
</script>
</body>
</html>
